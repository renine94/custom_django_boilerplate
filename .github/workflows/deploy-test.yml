name: üöÄ [CICD ÌÖåÏä§Ìä∏...]

on:
  push:
    branches: [main]

concurrency:
  group: deploy-test
  cancel-in-progress: true

env:
  APP_ENV: test
  ECR_NAME: my-backend-test
  AWS_ACCESS_KEY_ID1: ${{ dev.secrets.AWS_ACCESS_KEY_ID }}
  AWS_ACCESS_KEY_ID2: ${{ prod.secrets.aws.AWS_ACCESS_KEY_ID }}
  AWS_ACCESS_KEY_ID3: ${{ secrets.aws.AWS_ACCESS_KEY_ID }}
  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

jobs:
  build:
    name: build
    runs-on: ubuntu-latest
    steps:
      - name: 1) Checkout code
        uses: actions/checkout@v3

      - name: 2) Test 01
        run: |
          echo "CICD ÌÖåÏä§Ìä∏Î•º ÏãúÏûëÌï©ÎãàÎã§."
          echo GITHUB_ENV = $GITHUB_ENV
          echo GITHUB_ACTION = $GITHUB_ACTION
          echo GITHUB_EVENT_NAME = $GITHUB_EVENT_NAME
          
          echo AWS_ACCESS_KEY_ID1 = $AWS_ACCESS_KEY_ID1
          echo AWS_ACCESS_KEY_ID2 = $AWS_ACCESS_KEY_ID2
          echo AWS_ACCESS_KEY_ID3 = $AWS_ACCESS_KEY_ID3

      - name: 3) ECR Ï†ÄÏû•ÏÜå Ïù¥Î¶Ñ
        run: |
          echo ECR_NAME = $ECR_NAME

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.aws.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.aws.AWS_SECRET_ACCESS_KEY }}
          aws-region: ap-northeast-2

      - name: 5) Amazon ECR Î°úÍ∑∏Ïù∏
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1